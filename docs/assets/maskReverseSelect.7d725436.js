import{_ as R,l as L,b as H,a as h,x as $,y as B,o as M,c as G,w as b,d as w,h as c,t as g}from"./index.a197349c.js";/* empty css                 */import{g as y}from"./api.a5535ada.js";import{m as U}from"./modifyMap.01247dc3.js";import{_ as Y}from"./OperateBox.aa90113e.js";import"./request.ca64a295.js";import"./axios.a5b46551.js";const K=""+new URL("../HuBeiMap/images/jingqu.png",import.meta.url).href;const W={class:"dialog-title"},z={class:"intro"},J={class:"landmarkName"},q={class:"location"},Q={class:"dialog-content"},X={class:"dialog-content-item"},Z={class:"value"},ee={class:"dialog-content-item js"},te={class:"label"},oe={class:"value"},ie={class:"dialog-content-item time-item"},se={class:"time"},ne={class:"activity"},re={__name:"maskReverseSelect",setup(ae){const{viewer:d}=window,D=async()=>{const{res:i}=await y("/HuBeiMap/json/Hubei.json"),{features:n}=i,e=[],t=[];n.forEach((o,a)=>{const s=[],r=o.geometry.coordinates;let l;o.geometry.type==="Polygon"?l=r[0]:(o.geometry.type,l=r[0][0]);for(let C=0,F=l.length;C<F;C++)s.push(l[C][0]),s.push(l[C][1]);var u=Cesium.Cartesian3.fromDegreesArray(s);e.push({positions:u});const p=new Cesium.Entity({id:`line_${a}`,polyline:{positions:u,width:2,material:Cesium.Color.fromCssColorString("#fff"),clampToGround:!0}});t.push(p)}),new Cesium.Entity({id:"combined_area",polygon:{hierarchy:{positions:Cesium.Cartesian3.fromDegreesArray([100,0,100,89,160,89,160,0]),holes:e},material:Cesium.Color.BLACK.withAlpha(.9)}}),I(i),t.forEach(o=>{d.entities.add(o)}),T(),A(),E()},I=i=>{let n=i.features,e=[];n.forEach((t,o)=>{let a=[];const s=t.geometry.coordinates;let r;t.geometry.type==="Polygon"?r=s[0]:(t.geometry.type,r=s[0][0]);for(let p=0;p<r.length;p++){let C=r[p];a.push(C[0]),a.push(C[1])}e.push({positions:Cesium.Cartesian3.fromDegreesArray(a)});const l=Cesium.Cartesian3.fromDegreesArray(a),u=new Cesium.Entity({name:`\u52A8\u6001\u7ACB\u4F53\u5899\u8F6E\u5ED3_${o}`,polyline:{positions:l,width:2,material:Cesium.Color.fromCssColorString("#fb0d06"),clampToGround:!0}});d.entities.add(u)}),new Cesium.Entity({polygon:{hierarchy:{positions:Cesium.Cartesian3.fromDegreesArray([0,0,0,90,179,90,179,0]),holes:e},material:Cesium.Color.fromCssColorString("#0C1F34")}})},k=async()=>{try{const{res:i}=await y("/HuBeiMap/json/red.geojson"),{features:n}=i,e={};return n.forEach(t=>{const o=t.properties.region;e[o]=(e[o]||0)+1}),e}catch(i){return console.error("\u83B7\u53D6\u5EFA\u7B51\u6570\u91CF\u5931\u8D25:",i),{}}},A=async()=>{const{res:i}=await y("/HuBeiMap/json/region.json"),{features:n}=i,e=await k();n.forEach((t,o)=>{const{coordinates:a}=t.geometry,{NAME:s,QUHUADAIMA:r}=t.properties,l=e[s]||0,u=new Cesium.Entity({id:`region_name_${r}_${o}`,position:Cesium.Cartesian3.fromDegrees(a[0],a[1]),label:{text:s,font:"18px sans-serif",scale:.7,fillColor:Cesium.Color.fromCssColorString("#fff"),verticalOrigin:Cesium.VerticalOrigin.TOP,pixelOffset:new Cesium.Cartesian2(0,0),disableDepthTestDistance:Number.POSITIVE_INFINITY,style:Cesium.LabelStyle.FILL_AND_OUTLINE,backgroundColor:Cesium.Color.BLACK.withAlpha(.3),backgroundPadding:new Cesium.Cartesian2(8,4),showBackground:!0,backgroundColor:Cesium.Color.PINK.withAlpha(.2),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(8e4,3e6),scaleByDistance:new Cesium.NearFarScalar(150,2,15e6,.5)},properties:{name:s,code:r,data:t.properties,type:"region_billboard"}});if(d.entities.add(u),l>0){const p=new Cesium.Entity({id:`region_count_${r}_${o}`,position:Cesium.Cartesian3.fromDegrees(a[0],a[1]),label:{text:`(${l})`,font:"18px sans-serif",scale:.7,style:Cesium.LabelStyle.FILL_AND_OUTLINE,fillColor:Cesium.Color.fromCssColorString("#ff0000"),outlineColor:Cesium.Color.fromCssColorString("#fff"),outlineWidth:2,verticalOrigin:Cesium.VerticalOrigin.TOP,pixelOffset:new Cesium.Cartesian2(0,30),disableDepthTestDistance:Number.POSITIVE_INFINITY,backgroundColor:Cesium.Color.WHITE.withAlpha(.8),backgroundPadding:new Cesium.Cartesian2(6,3),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(8e4,3e6),scaleByDistance:new Cesium.NearFarScalar(150,1.8,15e6,.4)},properties:{name:s,code:r,count:l,type:"region_count"}});d.entities.add(p)}}),N()},E=async()=>{const{res:i}=await y("/HuBeiMap/json/red.geojson"),{features:n}=i;n.forEach((e,t)=>{const{coordinates:o}=e.geometry,{region:a,landmarkName:s}=e.properties,r=new Cesium.Entity({id:`build_billboard_${a}_${t}`,position:Cesium.Cartesian3.fromDegrees(o[0],o[1]),label:{text:s,font:"22px sans-serif",scale:1,style:Cesium.LabelStyle.FILL_AND_OUTLINE,fillColor:Cesium.Color.fromCssColorString("#f00"),outlineWidth:1,outlineColor:Cesium.Color.fromCssColorString("#666"),verticalOrigin:Cesium.VerticalOrigin.TOP,pixelOffset:new Cesium.Cartesian2(0,-65),disableDepthTestDistance:Number.POSITIVE_INFINITY,showBackground:!0,backgroundColor:Cesium.Color.fromCssColorString("#666").withAlpha(.2),backgroundPadding:new Cesium.Cartesian2(10,6),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(50,8e4)},billboard:{image:"/HuBeiMap/images/dj.png",scale:.8,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,disableDepthTestDistance:Number.POSITIVE_INFINITY,width:50,height:50,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(50,8e4)},properties:{data:e.properties,type:"build_billboard"}});d.entities.add(r)})},S=(i,n)=>{const e=n.scene;let t;const o=e.pick(i);if(Cesium.defined(o)&&e.pickPositionSupported&&(t=e.pickPosition(i),t&&Cesium.Cartographic.fromCartesian(t).height<0)){const s=n.camera.getPickRay(i);t=e.globe.pick(s,e)}if(!Cesium.defined(t)){const a=n.camera.getPickRay(i);t=e.globe.pick(a,e)}return Cesium.defined(t)||(t=e.camera.pickEllipsoid(i,e.globe.ellipsoid)),t},N=()=>{d.cesiumWidget.screenSpaceEventHandler.setInputAction(i=>{const n=d.scene.pick(i.position);if(Cesium.defined(n)&&Cesium.defined(n.id)){const e=n.id;if(e.properties&&e.properties.type&&(e.properties.type.getValue()==="region_billboard"||e.properties.type.getValue()==="region_count")){const t=e.properties.name.getValue(),o=e.properties.code.getValue();console.log(`\u70B9\u51FB\u4E86\u5730\u533A: ${t} (${o})`);const s=(l=>["\u6B66\u6C49\u5E02","\u5B9C\u660C\u5E02","\u8944\u9633\u5E02","\u8346\u5DDE\u5E02","\u9EC4\u5188\u5E02"].includes(l)?1e5:14e4)(t),r=S(i.position,d);if(r){const l=Cesium.Cartographic.fromCartesian(r),u=+Cesium.Math.toDegrees(l.longitude).toFixed(8),p=+Cesium.Math.toDegrees(l.latitude).toFixed(8);d.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(u,p,s),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-45),roll:0},duration:1})}}if(e.properties&&e.properties.type&&e.properties.type.getValue()==="build_billboard"){const t=e.properties.data.getValue();console.log(`\u70B9\u51FB\u4E86\u5EFA\u7B51:--${JSON.stringify(t)} `),m.value=t,f.value=!0}}},Cesium.ScreenSpaceEventType.LEFT_CLICK)},O=()=>{d.scene.primitives.removeAll(),d.entities.removeAll(),d.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK)},T=async()=>{const{res:i}=await y("/HuBeiMap/json/Hubei.json");P(i.features)},P=i=>{let n=[];for(let t=0;t<i.length;t++){const o=i[t];for(let a=0;a<o.geometry.coordinates.length;a++){const s=o.geometry.coordinates[a].toString().split(",").map(Number);if(!s)continue;const r=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(s)),vertexFormat:Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,extrudedHeight:2e3}),l=Cesium.PolygonGeometry.createGeometry(r);n.push(new Cesium.GeometryInstance({id:o.properties,geometry:l,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString("rgba(206, 37, 49, 0.1)")),show:new Cesium.ShowGeometryInstanceAttribute(!0)}}))}}const e=new Cesium.Primitive({releaseGeometryInstances:!1,geometryInstances:n,appearance:new Cesium.PerInstanceColorAppearance({translucent:!0,closed:!1}),asynchronous:!1});d.scene.primitives.add(e)};L(async()=>{U({viewer:d,style:"normal",changeColor:!1}),D(),_.value=await x()}),H(()=>{O()});const x=async()=>{try{const[i,n]=await Promise.all([y("/HuBeiMap/json/region.json"),y("/HuBeiMap/json/red.geojson")]),e=i.res.features,t=n.res.features,o={};return t.forEach(s=>{const r=s.properties.region;o[r]||(o[r]=[]),o[r].push({value:s.properties.landmarkName,label:s.properties.landmarkName,data:{coordinates:s.geometry.coordinates,properties:s.properties}})}),e.map(s=>{const r=s.properties.NAME,l=o[r]||[];return{value:r,label:`${r} (${l.length})`,data:{coordinates:s.geometry.coordinates,properties:s.properties},children:l}})}catch(i){return console.error("\u751F\u6210\u7EA7\u8054\u9009\u62E9\u5668\u6570\u636E\u5931\u8D25:",i),[]}},V={checkStrictly:!0},_=h([]),v=h([]),j=i=>{if(!i||i.length===0)return;const e=((t,o)=>{let a=t,s=null;for(let r=0;r<o.length;r++){const l=a.find(u=>u.value===o[r]);l&&(s=l.data,r<o.length-1&&l.children&&(a=l.children))}return s})(_.value,i);if(e&&e.coordinates){const t=e.coordinates;let o,a;if(Array.isArray(t)&&t.length>=2&&(typeof t[0]=="number"?[o,a]=t:Array.isArray(t[0])&&([o,a]=t[0])),o!==void 0&&a!==void 0){const s=i.length===1?2e5:1e5;d.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(o,a,s),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-45),roll:0},duration:2}),console.log(`\u98DE\u884C\u5230: ${i.join(" -> ")} (${o.toFixed(4)}, ${a.toFixed(4)})`),i.length===2&&e.properties&&(m.value=e.properties,f.value=!0)}}},f=h(!1),m=h({region:"\u6B66\u6C49\u5E02",landmarkName:"\u516B\u8DEF\u519B\u6B66\u6C49\u529E\u4E8B\u5904\u65E7\u5740",landmarkIntroduction:"\u516B\u8DEF\u519B\u6B66\u6C49\u529E\u4E8B\u5904\u65E7\u5740\u4F4D\u4E8E\u6B66\u6C49\u5E02\u6C5F\u5CB8\u533A\u957F\u6625\u885757\u53F7\u30021937\u5E7412\u6708-1938\u5E7410\u6708\u671F\u95F4\uFF0C\u8FD9\u91CC\u662F\u516B\u8DEF\u519B\u5728\u6B66\u6C49\u7684\u529E\u4E8B\u673A\u6784\u3002\u65E7\u5740\u4E3A\u4E00\u5E62\u56DB\u5C42\u697C\u623F\uFF0C\u590D\u539F\u4E86\u5F53\u5E74\u7684\u529E\u516C\u5BA4\u3001\u4F1A\u8BAE\u5BA4\u3001\u5BBF\u820D\u7B49\u573A\u666F\uFF0C\u5C55\u793A\u4E86\u516B\u8DEF\u519B\u6B66\u6C49\u529E\u4E8B\u5904\u5728\u5BA3\u4F20\u6297\u65E5\u3001\u8F93\u9001\u4EBA\u5458\u548C\u7269\u8D44\u3001\u5F00\u5C55\u7EDF\u4E00\u6218\u7EBF\u7B49\u65B9\u9762\u7684\u91CD\u8981\u5DE5\u4F5C\u3002",reflectedSpirit:"\u6297\u65E5\u7EDF\u6218\u7CBE\u795E",spiritConnotation:"\u79EF\u6781\u5021\u5BFC\u548C\u63A8\u52A8\u6297\u65E5\u6C11\u65CF\u7EDF\u4E00\u6218\u7EBF\u7684\u56E2\u7ED3\u534F\u4F5C\u7CBE\u795E\uFF1B\u8270\u82E6\u594B\u6597\u3001\u65E0\u79C1\u5949\u732E\u7684\u5DE5\u4F5C\u4F5C\u98CE\u3002",historicalPeriod:"\u65B0\u6C11\u4E3B\u4E3B\u4E49\u9769\u547D\u65F6\u671F",eventYear:"1937-1938\u5E74"});return(i,n)=>{const e=$,t=B;return M(),G(Y,null,{default:b(()=>[w(e,{modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=o=>v.value=o),options:_.value,props:V,clearable:"",filterable:"",onChange:j,placeholder:"\u9009\u62E9\u57CE\u5E02\u6216\u5EFA\u7B51",style:{width:"300px",margin:"10px 40px"}},null,8,["modelValue","options"]),w(t,{modelValue:f.value,"onUpdate:modelValue":n[2]||(n[2]=o=>f.value=o),width:"50%","show-close":!1},{header:b(()=>[c("div",W,[c("span",z,[n[3]||(n[3]=c("img",{class:"icon",src:K},null,-1)),c("span",J,g(m.value.landmarkName),1)]),c("div",q,g(m.value.region),1),c("div",{class:"close",onClick:n[1]||(n[1]=o=>f.value=!1)},"\u2014\u2014")])]),default:b(()=>[c("div",Q,[c("div",X,[n[4]||(n[4]=c("div",{class:"label"},"\u5730\u6807\u7B80\u4ECB",-1)),c("span",Z,g(m.value.landmarkIntroduction),1)]),c("div",ee,[c("div",te,g(m.value.reflectedSpirit),1),c("span",oe,g(m.value.spiritConnotation),1)]),c("div",ie,[c("div",se,g(m.value.historicalPeriod),1),c("div",ne,g(m.value.eventYear),1)])])]),_:1},8,["modelValue"])]),_:1})}}},ge=R(re,[["__scopeId","data-v-6e240915"]]);export{ge as default};
