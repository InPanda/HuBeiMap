import{_ as K}from"./OperateBox.4f5d7b99.js";import{aA as j,aB as b,aC as T,aD as I,aE as f,aF as x,aG as y,aH as z,aI as W,aJ as V,aK as U,aL as J,aM as B,aN as Y,_ as Q,C as Z,h as _,a as ee,o as te,c as ie,w as H,X as v,d as w,e as m}from"./index.5a6ceeba.js";import{E as ne}from"./el-input.5b582ca8.js";import{E as re}from"./el-button.147e94aa.js";function C(n){return j(n,(i,e)=>i+ae(e),0)}function ae(n){let i=0,e;switch(n.type){case"Polygon":return F(n.coordinates);case"MultiPolygon":for(e=0;e<n.coordinates.length;e++)i+=F(n.coordinates[e]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function F(n){let i=0;if(n&&n.length>0){i+=Math.abs(D(n[0]));for(let e=1;e<n.length;e++)i-=Math.abs(D(n[e]))}return i}var oe=b*b/2,L=Math.PI/180;function D(n){const i=n.length-1;if(i<=2)return 0;let e=0,t=0;for(;t<i;){const r=n[t],a=n[t+1===i?0:t+1],s=n[t+2>=i?(t+2)%i:t+2],u=r[0]*L,g=a[1]*L,h=s[0]*L;e+=(h-u)*Math.sin(g),t++}return e*oe}function se(n,i={}){const e=Number(n[0]),t=Number(n[1]),r=Number(n[2]),a=Number(n[3]);if(n.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const s=[e,t];return T([[s,[r,t],[r,a],[e,a],s]],i.properties,{bbox:n,id:i.id})}function le(n,i){var e=I(n),t=I(i),r=e.type,a=t.type;switch(r){case"Point":switch(a){case"MultiPoint":return ue(e,t);case"LineString":return x(e,t,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return f(e,t,{ignoreBoundary:!0});default:throw new Error("feature2 "+a+" geometry not supported")}case"MultiPoint":switch(a){case"MultiPoint":return he(e,t);case"LineString":return ce(e,t);case"Polygon":case"MultiPolygon":return ge(e,t);default:throw new Error("feature2 "+a+" geometry not supported")}case"LineString":switch(a){case"LineString":return pe(e,t);case"Polygon":case"MultiPolygon":return de(e,t);default:throw new Error("feature2 "+a+" geometry not supported")}case"Polygon":switch(a){case"Polygon":case"MultiPolygon":return me(e,t);default:throw new Error("feature2 "+a+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}}function ue(n,i){var e,t=!1;for(e=0;e<i.coordinates.length;e++)if(X(i.coordinates[e],n.coordinates)){t=!0;break}return t}function he(n,i){for(var e=0;e<n.coordinates.length;e++){for(var t=!1,r=0;r<i.coordinates.length;r++)X(n.coordinates[e],i.coordinates[r])&&(t=!0);if(!t)return!1}return!0}function ce(n,i){for(var e=!1,t=0;t<n.coordinates.length;t++){if(!x(n.coordinates[t],i))return!1;e||(e=x(n.coordinates[t],i,{ignoreEndVertices:!0}))}return e}function ge(n,i){for(var e=!0,t=!1,r=0;r<n.coordinates.length;r++){if(t=f(n.coordinates[r],i),!t){e=!1;break}t=f(n.coordinates[r],i,{ignoreBoundary:!0})}return e&&t}function pe(n,i){for(var e=0;e<n.coordinates.length;e++)if(!x(n.coordinates[e],i))return!1;return!0}function de(n,i){var e=y(i),t=y(n);if(!G(e,t))return!1;for(var r=!1,a=0;a<n.coordinates.length;a++){if(!f(n.coordinates[a],i))return!1;if(r||(r=f(n.coordinates[a],i,{ignoreBoundary:!0})),!r&&a<n.coordinates.length-1){var s=fe(n.coordinates[a],n.coordinates[a+1]);r=f(s,i,{ignoreBoundary:!0})}}return r}function me(n,i){var e=y(n),t=y(i);if(!G(t,e))return!1;for(var r=0;r<n.coordinates[0].length;r++)if(!f(n.coordinates[0][r],i))return!1;return!0}function G(n,i){return!(n[0]>i[0]||n[2]<i[2]||n[1]>i[1]||n[3]<i[3])}function X(n,i){return n[0]===i[0]&&n[1]===i[1]}function fe(n,i){return[(n[0]+i[0])/2,(n[1]+i[1])/2]}function k(n,i={}){let e=0,t=0,r=0;return z(n,function(a){e+=a[0],t+=a[1],r++},!0),W([e/r,t/r],i.properties)}function N(n){return se(y(n))}function O(n,i,e={}){e.mask&&!e.units&&(e.units="kilometers");for(var t=[],r=n[0],a=n[1],s=n[2],u=n[3],g=i/V([r,a],[s,a],e),h=g*(s-r),o=i/V([r,a],[r,u],e),l=o*(u-a),c=s-r,p=u-a,d=Math.floor(c/h),P=Math.floor(p/l),$=(c-d*h)/2,q=(p-P*l)/2,M=r+$;M<=s;){for(var E=a+q;E<=u;){var A=W([M,E],e.properties);e.mask?le(A,e.mask)&&t.push(A):t.push(A),E+=l}M+=h}return U(t)}function S(n,i){const e=[];return J(n,function(t){let r=!1;if(t.geometry.type==="Point")B(i,function(s){f(t,s)&&(r=!0)}),r&&e.push(t);else if(t.geometry.type==="MultiPoint"){var a=[];B(i,function(s){z(t,function(u){f(u,s)&&(r=!0,a.push(u))})}),r&&e.push(Y(a,t.properties))}else throw new Error("Input geometry must be a Point or MultiPoint")}),U(e)}class ve{constructor(i,e){var t=this;this.viewer=i,this.optS=e||{},this.handler=null,this.polygon=null,this.wall=null,this.initHeight=0,this.minHeight=0,this.maxHeight=0,this.volumn=0,this.label=null,this.cartesian=null,this.poly=null,this.area=null,this.cellsize=null,this.centroid=null,this.planeHeight=0,this.positions=[],this.Cartesian2Array=[],this.floatingPointLis=[],i.scene.globe.depthTestAgainstTerrain=!0,this.data=[],this.PolygonPrimitive=function(){function u(g){this.options={name:"\u591A\u8FB9\u5F62",polygon:{show:!0,perPositionHeight:!0,material:Cesium.Color.CHARTREUSE.withAlpha(.5)}},this.hierarchy=g,this._init()}return u.prototype._init=function(){var g=this,h=function(){return new Cesium.PolygonHierarchy(g.hierarchy)};this.options.polygon.hierarchy=new Cesium.CallbackProperty(h,!1),t.polygon=t.viewer.entities.add(this.options)},u}();var r=document.createElement("div");r.setAttribute("class","roamWidget_tooltip");var a=document.createElement("div");a.setAttribute("class","roamWidget_tooltip_arrow"),r.appendChild(a);var s=document.createElement("div");s.setAttribute("class","roamWidget_tooltip_inner"),r.appendChild(s),s.innerHTML="\u5355\u51FB \u5F00\u59CB\u7ED8\u5236",this.tooltip=r,this.tooltipInner=s}initMeasureVolume(i){var e=this;e.positions=[],e.Cartesian2Array=[],e.handler=new Cesium.ScreenSpaceEventHandler(e.viewer.scene.canvas),e.tooltip.style.left="-100000px",e.tooltip.style.top="-100000px",document.getElementsByTagName("body")[0].appendChild(e.tooltip),e.viewer.scene.canvas.style.cursor="crosshair",e.handler.setInputAction(function(t){var r=e.viewer.camera.getPickRay(t.endPosition);e.cartesian=e.viewer.scene.globe.pick(r,e.viewer.scene),e.cartesian!=null&&(e.positions.length>=2&&(Cesium.defined(e.poly)?e.cartesian!=null&&(e.positions.pop(),e.cartesian.y+=1+Math.random(),e.positions.push(e.cartesian)):e.poly=new e.PolygonPrimitive(e.positions)),e.tooltip.style.left=t.endPosition.x+20+"px",e.tooltip.style.top=t.endPosition.y-10+"px")},Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.handler.setInputAction(function(t){var r=e.viewer.camera.getPickRay(t.position);e.cartesian=e.viewer.scene.globe.pick(r,e.viewer.scene),e.cartesian!=null&&(e.positions.length==0&&e.positions.push(e.cartesian.clone()),e.positions.push(e.cartesian),e.tooltipInner.innerHTML="\u5355\u51FB\u589E\u52A0\u70B9\uFF0C\u53F3\u952E\u7ED3\u675F")},Cesium.ScreenSpaceEventType.LEFT_CLICK),e.handler.setInputAction(function(t){e.viewer.entities.remove(e.polygon),document.getElementsByTagName("body")[0].removeChild(e.tooltip),e.viewer.scene.canvas.style.cursor="",e.handler.destroy(),e.positions.pop();var r=e.viewer.scene.globe.ellipsoid;e.positions.forEach(c=>{var p=r.cartesianToCartographic(c),d=Cesium.Math.toDegrees(p.latitude),P=Cesium.Math.toDegrees(p.longitude);e.Cartesian2Array.push([P,d])}),e.Cartesian2Array.push(e.Cartesian2Array[0]);let a=T([e.Cartesian2Array]);e.cellsize=Math.sqrt(C(a)/1e4);let s=N(a);e.area=C(a),e.centroid=k(a);let u=y(s),g=O(u,e.cellsize,{units:"meters"}),h=S(g,a),o=[],l=h.features;for(let c=0;c<l.length;c++)o.push({lon:l[c].geometry.coordinates[0],lat:l[c].geometry.coordinates[1]});R.LonlatPointsTerrainData(e.viewer.terrainProvider,o,e.optS.terrainLevel,c=>{e.getVolumn(c),i({planeHeight:e.minHeight,wallMinHeight:e.minHeight,wallMaxHeight:e.maxHeight})},e.viewer)},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}initMeasure(i){var e=this;e.positions=[],e.Cartesian2Array=[],e.tooltip.style.left="-100000px",e.tooltip.style.top="-100000px";var t=e.viewer.scene.globe.ellipsoid;e.positions=i,e.positions.forEach(l=>{var c=t.cartesianToCartographic(l),p=Cesium.Math.toDegrees(c.latitude),d=Cesium.Math.toDegrees(c.longitude);e.Cartesian2Array.push([d,p])}),e.Cartesian2Array.push(e.Cartesian2Array[0]),e.minHeight=3e3,e.initHeight=4e3,e.maxHeight=5e3;let r=T([e.Cartesian2Array]);e.cellsize=Math.sqrt(C(r)/1e4);let a=N(r);e.area=C(r),e.centroid=k(r);let s=y(a),u=O(s,e.cellsize,{units:"meters"}),g=S(u,r),h=[],o=g.features;for(let l=0;l<o.length;l++)h.push({lon:o[l].geometry.coordinates[0],lat:o[l].geometry.coordinates[1]});R.LonlatPointsTerrainData(e.viewer.terrainProvider,h,e.optS.terrainLevel,l=>{e.getVolumn(l,!0)},e.viewer)}getVolumn(i,e){var t=this;t.data=i;let r=[];var a=t.viewer.scene.globe.ellipsoid;t.positions.forEach(l=>{var c=a.cartesianToCartographic(l);let p=t.viewer.scene.globe.getHeight(c);r.push(p),t.floatingPoint=t.viewer.entities.add({position:l,label:{text:"\u6D77\u62D4:"+p.toFixed(2)+"\u7C73",font:"19px sans-serif",fillColor:Cesium.Color.GOLD,style:Cesium.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,pixelOffset:new Cesium.Cartesian2(0,-20)}}),t.floatingPointLis.push(t.floatingPoint)}),e||(t.minHeight=ye(r),t.initHeight=t.planeHeight=t.minHeight,t.maxHeight=we(r)),t.volumn=0;for(let l=0;l<i.length;l++)t.volumn+=(i[l].height-t.minHeight)*t.cellsize*t.cellsize;let s=[],u=[],g=[];t.Cartesian2Array.forEach(l=>{console.log(l),l.forEach((c,p)=>{s.push(c),p==1&&s.push(0)}),u.push(t.minHeight),g.push(t.maxHeight)}),t.wall=t.viewer.entities.add({wall:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(s),minimumHeights:u,maximumHeights:g,outline:!0,outlineColor:Cesium.Color.WHITE.withAlpha(.7),material:Cesium.Color.CYAN.withAlpha(.7)}}),t.polygon=t.viewer.entities.add({polygon:{show:!0,hierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(s)),height:t.minHeight,material:Cesium.Color.CHARTREUSE.withAlpha(.5)}});let h=0,o=0;t.volumn/1e4>.01?h=(t.volumn/1e4).toFixed(2)+"\u4E07\u7ACB\u65B9\u7C73":h=t.volumn.toFixed(2)+"\u7ACB\u65B9\u7C73",t.area/1e4>.01?o=(t.area/1e4).toFixed(2)+"\u4E07\u5E73\u65B9\u7C73":o=t.area.toFixed(2)+"\u5E73\u65B9\u7C73",t.label=t.viewer.entities.add({name:"\u98DE\u673A",position:Cesium.Cartesian3.fromDegrees(t.centroid.geometry.coordinates[0],t.centroid.geometry.coordinates[1],t.maxHeight),label:{text:"\u6316\u65B9\u4F53\u79EF\uFF1A"+h+`
\u6A2A\u5207\u9762\u79EF\uFF1A`+o,font:"18px sans-serif",showBackground:!0,fillColor:Cesium.Color.WHITE,style:Cesium.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,pixelOffset:new Cesium.Cartesian2(0,-80)}})}setParameters(i,e){if(this.planeHeight=i.planeHeight==null?this.planeHeight:i.planeHeight,this.minHeight=i.wallMinHeight==null?this.minHeight:i.wallMinHeight,this.maxHeight=i.wallMaxHeight==null?this.maxHeight:i.wallMaxHeight,this.planeHeight<this.minHeight&&(this.minHeight=this.planeHeight),this.planeHeight>this.maxHeight&&(this.maxHeight=this.planeHeight),Cesium.defined(this.polygon)&&this.polygon.polygon.height.setValue(this.planeHeight),Cesium.defined(this.wall)){let t=[];for(let a=0;a<this.wall.wall.minimumHeights.getValue().length;a++)t.push(this.minHeight);this.wall.wall.minimumHeights.setValue(t);let r=[];for(let a=0;a<this.wall.wall.maximumHeights.getValue().length;a++)r.push(this.maxHeight);this.wall.wall.maximumHeights.setValue(r)}this.calculateBulk(),e({planeHeight:this.planeHeight,wallMinHeight:this.minHeight,wallMaxHeight:this.maxHeight})}calculateBulk(){let i=this.area*(this.planeHeight-this.minHeight),e=0;this.volumn=0;for(let a=0;a<this.data.length;a++)this.volumn+=(this.data[a].height-this.minHeight)*this.cellsize*this.cellsize,this.data[a].height>this.planeHeight&&(e+=(this.data[a].height-this.planeHeight)*this.cellsize*this.cellsize);let t=0;this.initHeight<=this.planeHeight&&(t=i-(this.volumn-e)),t>0?(t/1e4>.01?t=(t/1e4).toFixed(2)+"\u4E07\u7ACB\u65B9\u7C73":t=t.toFixed(2)+"\u7ACB\u65B9\u7C73",t="\u586B\u65B9\u4F53\u79EF\uFF1A"+t+`
`):t="",e>0?(e/1e4>.01?e=(e/1e4).toFixed(2)+"\u4E07\u7ACB\u65B9\u7C73":e=e.toFixed(2)+"\u7ACB\u65B9\u7C73",e="\u6316\u65B9\u4F53\u79EF\uFF1A"+e+`
`):e="";let r=this.area;r/1e4>.01?r=(r/1e4).toFixed(2)+"\u4E07\u5E73\u65B9\u7C73":r=r.toFixed(2)+"\u5E73\u65B9\u7C73",this.label.label.text.setValue(t+e+"\u6A2A\u5207\u9762\u79EF\uFF1A"+r)}clear(){this.floatingPointLis.length>0&&this.floatingPointLis.forEach(i=>{this.viewer.entities.remove(i)}),Cesium.defined(this.wall)&&this.viewer.entities.remove(this.wall),Cesium.defined(this.polygon)&&this.viewer.entities.remove(this.polygon),Cesium.defined(this.label)&&this.viewer.entities.remove(this.label)}}function ye(n){return n=n.sort((i,e)=>i-e),n[0]}function we(n){return n=n.sort((i,e)=>e-i),n[0]}var R=function(){function n(){}return n.LonlatPointsTerrainData=function(i,e,t=13,r,a){for(var s=[],u=0;u<e.length;u++)s.push(Cesium.Cartographic.fromDegrees(e[u].lon,e[u].lat));Cesium.sampleTerrainMostDetailed(a.terrainProvider,s).then(g=>{r(g)})},n.CartographicPointsTerrainData=function(i,e,t,r){!(e.length&&e.length>0)||Cesium.sampleTerrainMostDetailed(r.terrainProvider,e).then(a=>{t(a)})},n}();const He={class:"menu-container"},Ce={__name:"cutAndFill",setup(n){const{viewer:i}=window;i.camera.setView({destination:Cesium.Cartesian3.fromDegrees(115.15,27.15,5e4)}),Z(async()=>{i.terrainProvider=await Cesium.createWorldTerrainAsync({requestVertexNormals:!0})});const e=new ve(i),t=_(""),r=_(""),a=_(""),s=()=>{e.initMeasureVolume(h=>{t.value=h.planeHeight.toFixed(1),r.value=h.wallMinHeight.toFixed(1),a.value=h.wallMaxHeight.toFixed(1)})},u=()=>{e.clear()},g=()=>{e.setParameters({planeHeight:Number(t.value),wallMinHeight:Number(r.value),wallMaxHeight:Number(a.value)},h=>{console.log(h)})};return ee(()=>{u()}),(h,o)=>{const l=re,c=ne,p=K;return te(),ie(p,null,{default:H(()=>[v("div",He,[v("p",null,[w(l,{type:"primary",onClick:s},{default:H(()=>o[3]||(o[3]=[m("\u7ED8\u5236")])),_:1}),w(l,{type:"primary",onClick:u},{default:H(()=>o[4]||(o[4]=[m("\u6E05\u9664")])),_:1}),w(l,{type:"primary",onClick:g},{default:H(()=>o[5]||(o[5]=[m("\u8C03\u6574")])),_:1})]),v("p",null,[o[6]||(o[6]=m(" \u57FA\u51C6\u9762\u9AD8 ")),w(c,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=d=>t.value=d),size:"small",style:{width:"120px"}},null,8,["modelValue"]),o[7]||(o[7]=v("br",null,null,-1)),o[8]||(o[8]=m(" \u56F4\u5899\u5E95\u9AD8 ")),w(c,{modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=d=>r.value=d),size:"small",style:{width:"120px"}},null,8,["modelValue"]),o[9]||(o[9]=v("br",null,null,-1)),o[10]||(o[10]=m(" \u56F4\u5899\u9876\u9AD8 ")),w(c,{modelValue:a.value,"onUpdate:modelValue":o[2]||(o[2]=d=>a.value=d),size:"small",style:{width:"120px"}},null,8,["modelValue"]),o[11]||(o[11]=m("(\u5899\u663E\u793A\u6548\u679C\uFF0C\u4E0E\u7ED3\u7B97\u7ED3\u679C\u65E0\u5173) "))]),o[12]||(o[12]=v("p",{class:"description"},[m(' 1. \u6316\u65B9\u91CF: \u8BA1\u7B97"\u57FA\u51C6\u9762"\u5230\u5730\u8868\u4E4B\u95F4\u7684\u51F8\u51FA\u90E8\u5206\u8FDB\u884C\u6316\u6389\u7684\u4F53\u79EF\u3002 '),v("br"),m(' 2. \u586B\u65B9\u91CF\uFF1A\u8BA1\u7B97"\u57FA\u51C6\u9762"\u4E0E"\u5899\u5E95\u90E8"\u4E4B\u95F4\u7684\u7F3A\u5C11\u90E8\u5206\u8FDB\u884C\u586B\u5E73\u7684\u4F53\u79EF\u3002 ')],-1))])]),_:1})}}},Ae=Q(Ce,[["__scopeId","data-v-d8c73664"]]);export{Ae as default};
